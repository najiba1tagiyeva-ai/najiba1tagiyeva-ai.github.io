{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "description": "CO₂ vs GDP scatter with carbon intensity, regression line, and 95% confidence interval (Azerbaijan, 1990–2024).",
  "data": {
    "url": "https://raw.githubusercontent.com/najiba1tagiyeva-ai/najiba1tagiyeva-ai.github.io/refs/heads/main/Project_Chart2_Azerbaijan's_annual-co2-emissions-per-country.csv",
    "format": { "type": "csv" }
  },
  "title": {
    "text": "The Carbon Cost of Growth: CO₂ Emissions vs GDP",
    "subtitle": [
      "Linear Regression (R² = 0.430) | Azerbaijan, 1990–2024 (n=35 years) | Source: World Bank Open Data",
      "Click legend categories to filter • Hover points for details",
      ""
    ],
    "subtitleFontStyle": "italic",
    "subtitleFontSize": 13,
    "fontSize": 20,
    "fontWeight": "normal",
    "anchor": "start",
    "color": "#1f2937",
    "subtitleColor": "#6b7280"
  },
  "width": 900,
  "height": 450,
  "transform": [
    { "calculate": "toNumber(datum['Year'])", "as": "year" },
    { "calculate": "toNumber(datum['GDP (constant 2015 US$)'])", "as": "gdp" },
    { "calculate": "toNumber(datum['Annual CO₂ emissions'])", "as": "co2" },
    { "calculate": "datum.gdp / 1e9", "as": "gdpB" },
    { "calculate": "datum.co2 / 1e6", "as": "co2M" },
    { "calculate": "(datum.co2 / datum.gdp) * 1000", "as": "carbonIntensity" },
    {
      "calculate": "datum.carbonIntensity >= 2 ? 'High (≥2.0)' : datum.carbonIntensity <= 1 ? 'Low (<1.0)' : 'Medium (1.0–2.0)'",
      "as": "intensityCategory"
    },
    {
      "calculate": "datum.year + ': $' + format(datum.gdpB, '.1f') + 'B GDP, ' + format(datum.co2M, '.1f') + 'M tonnes CO₂'",
      "as": "summary"
    }
  ],
  "layer": [
    {
      "description": "95% Confidence interval band",
      "mark": {
        "type": "errorband",
        "extent": "ci",
        "opacity": 0.15,
        "color": "#475569"
      },
      "encoding": {
        "x": {
          "field": "gdpB",
          "type": "quantitative",
          "title": "GDP (constant 2015 US$ billions)",
          "scale": { "domain": [0, 70], "nice": true }
        },
        "y": {
          "field": "co2M",
          "type": "quantitative",
          "title": "Annual CO₂ emissions (million tonnes)",
          "scale": { "domain": [25, 60], "nice": true }
        }
      }
    },
    {
      "description": "Linear regression trend line",
      "transform": [
        { "regression": "co2M", "on": "gdpB", "as": ["gdpB_fit", "co2M_fit"] }
      ],
      "mark": {
        "type": "line",
        "stroke": "#475569",
        "strokeWidth": 2.5,
        "opacity": 0.8
      },
      "encoding": {
        "x": { "field": "gdpB_fit", "type": "quantitative" },
        "y": { "field": "co2M_fit", "type": "quantitative" }
      }
    },
    {
      "params": [
        {
          "name": "hover",
          "select": {
            "type": "point",
            "fields": ["year"],
            "on": "mouseover",
            "clear": "mouseout"
          }
        },
        {
          "name": "select",
          "select": {
            "type": "point",
            "fields": ["intensityCategory"]
          },
          "bind": "legend"
        }
      ],
      "mark": {
        "type": "point",
        "filled": true,
        "stroke": "#ffffff",
        "strokeWidth": 1.5
      },
      "encoding": {
        "x": {
          "field": "gdpB",
          "type": "quantitative",
          "axis": { 
            "grid": true, 
            "gridOpacity": 0.15,
            "tickCount": 7,
            "labelFontSize": 12,
            "titleFontSize": 13
          }
        },
        "y": {
          "field": "co2M",
          "type": "quantitative",
          "axis": { 
            "grid": true, 
            "gridOpacity": 0.15,
            "tickCount": 7,
            "labelFontSize": 12,
            "titleFontSize": 13
          }
        },
        "color": {
          "field": "intensityCategory",
          "type": "nominal",
          "title": "Carbon intensity (tonnes CO₂ per million USD)",
          "scale": {
            "domain": ["High (≥2.0)", "Medium (1.0–2.0)", "Low (<1.0)"],
            "range": ["#d73027", "#f59e0b", "#1a9850"]
          },
          "legend": {
            "orient": "right",
            "titleFontSize": 13,
            "titleFontWeight": "normal",
            "titleLimit": 250,
            "labelFontSize": 12,
            "symbolSize": 150,
            "symbolStrokeWidth": 0,
            "padding": 5,
            "offset": 5
          }
        },
        "size": {
          "condition": [
            { "test": { "param": "hover", "empty": false }, "value": 400 }
          ],
          "value": 180
        },
        "opacity": {
          "condition": [
            { "test": { "param": "hover", "empty": false }, "value": 1 },
            { "test": { "param": "select", "empty": false }, "value": 0.9 }
          ],
          "value": 0.25
        },
        "strokeWidth": {
          "condition": [
            { "test": { "param": "hover", "empty": false }, "value": 3 }
          ],
          "value": 1.5
        },
        "tooltip": [
          { "field": "summary", "type": "nominal", "title": "Summary" },
          {
            "field": "carbonIntensity",
            "type": "quantitative",
            "title": "Carbon intensity (t CO₂/M$)",
            "format": ".2f"
          },
          {
            "field": "intensityCategory",
            "type": "nominal",
            "title": "Category"
          }
        ]
      }
    }
  ],
  "config": {
    "view": { 
      "strokeWidth": 0,
      "continuousWidth": 700,
      "continuousHeight": 450
    },
    "axis": {
      "labelFontSize": 12,
      "titleFontSize": 13,
      "titleFontWeight": "normal",
      "labelColor": "#4b5563",
      "titleColor": "#1f2937",
      "domainColor": "#d1d5db",
      "tickColor": "#d1d5db",
      "gridColor": "#e5e7eb"
    },
    "legend": {
      "labelFontSize": 12,
      "titleFontSize": 13,
      "titleColor": "#1f2937",
      "labelColor": "#4b5563"
    },
    "title": {
      "font": "sans-serif",
      "fontWeight": "normal"
    },
    "background": "#ffffff"
  }
}
